<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <style>
    /* 重置默认边距和内边距 */
    body,
    html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: black;
    }

    p {
      color: white;
      text-align: center;
      font-size: 24px;
      margin-bottom: 10px;
    }

    canvas {
      /* 使用视口单位确保始终占满窗口 */
      width: 100vw;
      height: calc(100vh - 100px); /* 减去<p>标签的高度 */
    }
  </style>
</head>

<body>
  <p>To：李鹏</br>“愿你在2025年里，生活如烟花般绚烂，每一个梦想都能绽放光彩，新年快乐！”</p>
  <canvas id="greetingCanvas"></canvas>
  <audio id="fireworkSound" src="https://www.soundjay.com/misc/sounds/firework-01.mp3" preload="auto"></audio>
  <script>
    const canvas = document.getElementById('greetingCanvas');
    const ctx = canvas.getContext('2d');
    const fireworkSound = document.getElementById('fireworkSound');

    function updateCanvasSize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight - 34; // 减去<p>标签的高度
    }

    // 初始设置canvas尺寸
    updateCanvasSize();
    // 监听窗口resize事件，窗口大小变化时更新canvas尺寸
    window.addEventListener('resize', updateCanvasSize);

    const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF', '#FFA500', '#800080'];
    const particles = [];
    let titleColorIndex = 0;
    let tipColorIndex = 0;
    const colorChangeInterval = 50;
    let frameCount = 0;

    // 星星背景
    const stars = [];
    const starCount = 200;

    class Star {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 2;
        this.opacity = Math.random();
        this.blinkSpeed = Math.random() * 0.05;
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
        ctx.fill();
      }

      update() {
        this.opacity += this.blinkSpeed;
        if (this.opacity <= 0 || this.opacity >= 1) {
          this.blinkSpeed = -this.blinkSpeed;
        }
      }
    }

    // 初始化星星
    for (let i = 0; i < starCount; i++) {
      stars.push(new Star());
    }

    class Particle {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.color = colors[Math.floor(Math.random() * colors.length)];
        this.vx = Math.random() * 6 - 3;
        this.vy = Math.random() * 10 - 5;
        this.size = Math.random() * 4 + 1;
        this.life = 100; // 粒子生命周期
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.1;
        this.life--;
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, 2 * Math.PI);
        ctx.fillStyle = this.color;
        ctx.fill();
      }
    }

    canvas.addEventListener('click', function (event) {
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left + (Math.random() - 0.5) * 100; // 随机化爆炸位置
      const y = event.clientY - rect.top + (Math.random() - 0.5) * 100;

      for (let i = 0; i < 100; i++) { // 增加粒子数量
        particles.push(new Particle(x, y));
      }

      // 播放音效
      fireworkSound.currentTime = 0;
      fireworkSound.play();
    });

    function drawScene() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // 绘制星星背景
      stars.forEach(star => {
        star.update();
        star.draw();
      });

      // 绘制烟花粒子
      for (let i = 0; i < particles.length; i++) {
        const particle = particles[i];
        particle.update();
        particle.draw();

        if (particle.life <= 0 || particle.y > canvas.height) {
          particles.splice(i, 1);
          i--;
        }
      }

      // 文字颜色渐变
      frameCount++;
      if (frameCount % colorChangeInterval === 0) {
        titleColorIndex = (titleColorIndex + 1) % colors.length;
        tipColorIndex = (tipColorIndex + 1) % colors.length;
      }

      const titleColor = colors[titleColorIndex];
      ctx.font = '72px Arial';
      ctx.fillStyle = titleColor;
      ctx.shadowBlur = 10;
      ctx.shadowColor = titleColor;
      ctx.textAlign = 'center';
      ctx.fillText('2025新年快乐！', canvas.width / 2, canvas.height / 2);

      const tipColor = colors[tipColorIndex];
      ctx.font = '36px Arial';
      ctx.fillStyle = tipColor;
      ctx.shadowBlur = 5;
      ctx.shadowColor = tipColor;
      ctx.fillText('点击屏幕发射烟花', canvas.width / 2, canvas.height - 50);

      requestAnimationFrame(drawScene);
    }

    drawScene();
  </script>
</body>

</html>
